<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fruit Machine - TODO App</title>
</head>
<body>
	<div id='app'></div>

<!-- layout-i -->
<script type="text/template" id="template-layout">
	<div class='layout {{{fm_classes}}}' {{{fm_attrs}}}>
		<div class='layout_header'>{{{1}}}</div>
		<div class='layout_content'>
			<div class='layout_list'>{{{2}}}</div>
			<div class='layout_body'>{{{3}}}</div>
		</div>
	</div>
</script>

<!-- module-pineapple -->
<script type="text/template" id="template-pineapple">
	<div class='module-pineapple {{{fm_classes}}}' {{{fm_attrs}}}>
		<form class='module-pineapple_form'>
			<input class='module-pineapple_input' type='text' placeholder='Add a new item...' />
		</form>
	</div>
</script>

<!-- template-banana -->
<script type="text/template" id="template-banana">
	<div class='module-banana {{{fm_classes}}}' {{{fm_attrs}}}>
		{{#children}}{{{child}}}{{/children}}
	</div>
</script>

<!-- template-stawberry -->
<script type="text/template" id="template-strawberry">
	<div class='module-stawberry' {{{fm_attrs}}}>{{title}} <button class='js-delete-item'>Ã—</button></div>
</script>
<script type="text/javascript" src="../libs/hogan.js"></script>
<script type="text/javascript" src="../libs/delegate.js"></script>
<script type="text/javascript" src="../../lib/fruitmachine.js"></script>
<script type="text/javascript" src="modules/pineapple.js"></script>
<script type="text/javascript" src="modules/strawberry.js"></script>
<script>


var items = [
	{
		itemId: '1',
		title: 'Water the garden'
	},
	{
		itemId: '2',
		title: 'Bake some bread'
	},
	{
		itemId: '3',
		title: 'Wash the car'
	}
];

/**
 * Usage
 */

// Register module templates
var templates = {
	'layout': Hogan.compile(document.getElementById('template-layout').innerHTML),
	'pineapple': Hogan.compile(document.getElementById('template-pineapple').innerHTML),
	'banana': Hogan.compile(document.getElementById('template-banana').innerHTML),
	'strawberry': Hogan.compile(document.getElementById('template-strawberry').innerHTML)
};


FruitMachine.templates(function(module) {
	return templates[module].render(data);
});

// Define our view structure
var layout = {
	id: 'master',
	module: 'layout',
	children: [
		{
			id: 2,
			module: 'pineapple'
		},
		{
			id: 3,
			module: 'banana',
			children: []
		}
	]
};

// Create the FruitMachine View
var myView = new FruitMachine.View(layout);
var bananaView = myView.child('banana');

// Add each of our items as strawberry
// child views of the banana view.
items.forEach(function(item) {
	bananaView.add(new FruitMachine({ module: 'strawberry', model: item }));
});

// Render the view, inject it into the DOM and call setup.
myView
	.render()
	.inject(document.getElementById('app'))
	.setup();

// Add a callback to the `formsubmit` event
// emitted by the pineapple view.
myView.child('pineapple').on('formsubmit', function(value) {

	// Create a new view using the data submitted
	var newItem = new FruitMachine({ module: 'strawberry', model: { title: value } });

	// Render and init events
	newItem
		.render()
		.setup();

	// Add the new view to the banana view
	// at the first index
	bananaView.add(newItem, { at: 0 });
});

</script>
</body>
</html>