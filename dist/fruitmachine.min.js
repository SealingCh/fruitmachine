var FruitMachine=function(){var j,k,l,d=function(a){if(a.module){var b=j[a.module]||d;a._module=a.module;delete a.module;return new b(a)}this._configure(a);this.add(a.views);this.initialize(a)};d.VERSION="0.0.1";var o=function(){var a=0;return function(b){return(b||"")+ ++a*Math.round(1E7*Math.random())}}(),m=d.util={bind:function(a,b){return function(){return a.apply(b,arguments)}},bindAll:function(a,b){for(var c in a)"function"===typeof a[c]&&(a[c]=m.bind(a[c],b))},mixin:function(a){p.call(arguments,
1).forEach(function(b){for(var c in b)a[c]=b[c]});return a}},p=Array.prototype.slice,s=Array.prototype.concat,t=Object.prototype.hasOwnProperty,g=m.mixin,n=/\s+/,u=d.Events={on:function(a,b,c){var f,e,h,d,i;if(!b)return this;a=a.split(n);f=this._callbacks||(this._callbacks={});for(e=a.shift();e;)h=(i=f[e])?i.tail:{},h.next=d={},h.context=c,h.callback=b,f[e]={tail:d,next:i?i.next:h},e=a.shift();return this},off:function(a,b,c){var f,e,d,q,i,g;if(e=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,
this;for(a=a?a.split(n):Object.keys(e);f=a.shift();)if(d=e[f],delete e[f],d&&(b||c))for(q=d.tail;(d=d.next)!==q;)if(i=d.callback,g=d.context,b&&i!==b||c&&g!==c)this.on(f,i,g);return this}},trigger:function(a){var b,c,f,d,h,g;if(!(f=this._callbacks))return this;h=f.all;a=a.split(n);for(g=p.call(arguments,1);b=a.shift();){if(c=f[b])for(d=c.tail;(c=c.next)!==d;)c.callback.apply(c.context||this,g);if(c=h){d=c.tail;for(b=[b].concat(g);(c=c.next)!==d;)c.callback.apply(c.context||this,b)}}return this}};
d.helper=function(a,b){b.attach&&b.attach(d);k[a]=b};j={};l={};k={};var r=function(a){return l[a]};d.templates=function(a){var b=typeof a;"object"===b?g(l,a):"function"===b&&(r=a)};var v=function(a){var b=k[a];if(b=b&&b.exports)return"function"===typeof b?this[a]=new b(this):m.mixin(this,b)},w=function(a){if(a.onSetup)a.onSetup()},x=function(a){if(a.onTeardown)a.onTeardown()};g(d.prototype,u,{_configure:function(a){this._id=a.id||o("auto_");this._fmid=a.fmid||o("fmid");this.module=a._module;this.model=
a.model||{};this._lookup={};this._views=[];this.template=this.template||r(this.module);this.helpers=(this.helpers||[]).map(v,this)},initialize:function(){},onSetup:function(){},onTeardown:function(){},onDestroy:function(){},add:function(a){if(a){for(var b,a=s.call([],a),c=0,f=a.length;c<f;c++)b=a[c],b instanceof d||(b=new d(b)),this._views.push(b),this.addLookup(b),b.parent=this;return this}},addLookup:function(a){this._lookup[a.module]=this._lookup[a.module]||[];this._lookup[a.id()]=this._lookup[a.module]=
a},id:function(a){return a?this._lookup[a]:this._id},fmid:function(){return this._fmid},data:function(){return!this.model?{}:this.model.toJSON?this.model.toJSON():this.model},views:function(){return this._views},html:function(){var a={},b=this.views(),c,d;a.views=[];for(var e=0,h=b.length;e<h;e++)c=b[e],d=c.html(),a[c.id()]=d,a.views.push({view:d});a.fm_attrs='id="'+this.fmid()+'"';return this._html=this.template.render(g(a,this.data()))},render:function(){return this.update()},setup:function(a){var b=
a&&a.shallow,a=this.views();if(!b)for(var b=0,c=a.length;b<c;b++)a[b].setup();this.helpers.forEach(w,this);this.onSetup();this.trigger("setup");this.isSetup=!0;return this},teardown:function(a){var b=a&&a.shallow,a=this.views();if(!b)for(var b=0,c=a.length;b<c;b++)a[b].teardown();this.helpers.forEach(x,this);this.trigger("teardown");this.onTeardown();this.isSetup=!1;return this},el:function(){return this._el||(this._el=document.getElementById(this.fmid()))},update:function(){var a=this.el(),b=this.toNode();
if(!a&&!a.parentNode)return this._el=b,this;a.parentNode.replaceChild(b,a);this._el=b;return this},node:function(){var a=document.createElement("div");a.innerHTML=this.html();return a.firstElementChild},inject:function(a){var b=this.el();a.innerHTML="";a.appendChild(b)},toJSON:function(){var a={},b=this.views();a.views=[];for(var c=0,d=b.length;c<d;c++)a.views.push(b[c].toJSON());a.id=this.id();a.fmid=this.fmid();a.model=this.data();return a}});d.inherit=function(a,b){var c=this,d;d=a&&t.call(a,"constructor")?
a.constructor:function(){return c.apply(this,arguments)};g(d,c,b);var e=function(){this.constructor=d};e.prototype=c.prototype;d.prototype=new e;a&&g(d.prototype,a);d.__super__=c.prototype;return d};d.module=function(a,b){if("string"===typeof a)return j[a]=d.inherit(b);if("object"===typeof a)return d.inherit(a)};return d}(this);
